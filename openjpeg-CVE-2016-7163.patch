From d9520ebb1a8a87aa977898951aa5ba3ab3e80864 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Nikola=20Forr=C3=B3?= <nforro@redhat.com>
Date: Wed, 8 Feb 2017 16:35:30 +0100
Subject: [PATCH 1/2] Fix CVE-2016-7163

---
 libopenjpeg/j2k.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/libopenjpeg/j2k.c b/libopenjpeg/j2k.c
index 495cef6..1c4f776 100755
--- a/libopenjpeg/j2k.c
+++ b/libopenjpeg/j2k.c
@@ -467,6 +467,13 @@ static void j2k_read_siz(opj_j2k_t *j2k) {
 	cp->tx0 = cio_read(cio, 4);		/* XT0siz */
 	cp->ty0 = cio_read(cio, 4);		/* YT0siz */
 	
+	if ((cp->tdx<0)||(cp->tdy<0)||(cp->tx0<0)||(cp->ty0<0)) {
+		opj_event_msg(j2k->cinfo, EVT_ERROR,
+									"invalid tile size (tdx: %d, tdy: %d, tx0: %d, ty0: %d)\n",
+									cp->tdx, cp->tdy, cp->tx0, cp->ty0);
+		return;
+	}
+
 	image->numcomps = cio_read(cio, 2);	/* Csiz */
 
 #ifdef USE_JPWL
-- 
2.7.4

